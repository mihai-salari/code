#import <Foundation/Foundation.h>
#import "OrderEntry.h"

int main(int argc, const char * argv[]) {
    @autoreleasepool {
        //Address *a = [Address new];
        //OrderItem *oi = [OrderItem new];
        
        NSString *a123 = @"a123";
        
        OrderEntry *entry = [[OrderEntry alloc] initWithOrderID:a123];
        entry = [[OrderEntry alloc] initWithOrderID:@"222" orderItem:@"3 Sausages"];
        
        a123 = nil; // to test the ARC
        
        NSLog(@"New order, ID = %@, item = %@", entry.orderID, entry.item.name);
        
        entry = nil;
        
        NSLog(@"%@", entry);

        // To test strong reference cycle, first remove the weak qualifier in OrderItem
        OrderEntry *newEntry = [[OrderEntry alloc] initWithOrderID:@"222"];
        newEntry.item.entry = newEntry;
        
        newEntry = nil; // strong reference cycle will not deallocate the object properly, unless we use 'weak'
        
        OrderEntry *entry2 = [[OrderEntry alloc] initWithOrderID:@"999" orderItem:@"100 cheeseburgers"];
        
        NSLog(@"New order, ID = %@, item = %@", entry2.orderID, entry2.item.name); // Note that this is releas after we left autorelease pool, and WHY :)
        
        // The reason is due to how ARC works with property getter...
        
        NSLog(@"Leaving autorelease pool, fasten seat belt please!");
    }
    
    return 0;
}

/*

 2017-09-03 23:32:40.390064+0800 WithARC[64025:3830396] Initializing OrderEntry object...
 2017-09-03 23:32:40.390263+0800 WithARC[64025:3830396] Initializing OrderItem object (null)...
 2017-09-03 23:32:40.390296+0800 WithARC[64025:3830396] Initializing Address object...
 2017-09-03 23:32:40.390309+0800 WithARC[64025:3830396] Initializing OrderEntry object...
 2017-09-03 23:32:40.390319+0800 WithARC[64025:3830396] Initializing OrderItem object (null)...
 2017-09-03 23:32:40.390331+0800 WithARC[64025:3830396] Initializing Address object...
 2017-09-03 23:32:40.390361+0800 WithARC[64025:3830396] Deallocating OrderEntry object with ID a123...
 2017-09-03 23:32:40.390378+0800 WithARC[64025:3830396] Deallocating Addess object...
 2017-09-03 23:32:40.390394+0800 WithARC[64025:3830396] Deallocating OrderItem object Unknown...
 2017-09-03 23:32:40.390410+0800 WithARC[64025:3830396] New order, ID = 222, item = 3 Sausages
 2017-09-03 23:32:40.390422+0800 WithARC[64025:3830396] Deallocating OrderEntry object with ID 222...
 2017-09-03 23:32:40.390433+0800 WithARC[64025:3830396] Deallocating Addess object...
 2017-09-03 23:32:40.390442+0800 WithARC[64025:3830396] Deallocating OrderItem object 3 Sausages...
 2017-09-03 23:32:40.390564+0800 WithARC[64025:3830396] (null)
 2017-09-03 23:32:40.390609+0800 WithARC[64025:3830396] Initializing OrderEntry object...
 2017-09-03 23:32:40.390623+0800 WithARC[64025:3830396] Initializing OrderItem object (null)...
 2017-09-03 23:32:40.390635+0800 WithARC[64025:3830396] Initializing Address object...
 2017-09-03 23:32:40.390667+0800 WithARC[64025:3830396] Deallocating OrderEntry object with ID 222...
 2017-09-03 23:32:40.390677+0800 WithARC[64025:3830396] Deallocating Addess object...
 2017-09-03 23:32:40.390684+0800 WithARC[64025:3830396] Deallocating OrderItem object Unknown...
 2017-09-03 23:32:40.390691+0800 WithARC[64025:3830396] Initializing OrderEntry object...
 2017-09-03 23:32:40.390697+0800 WithARC[64025:3830396] Initializing OrderItem object (null)...
 2017-09-03 23:32:40.390704+0800 WithARC[64025:3830396] Initializing Address object...
 2017-09-03 23:32:40.390710+0800 WithARC[64025:3830396] New order, ID = 999, item = 100 cheeseburgers
 2017-09-03 23:32:40.390717+0800 WithARC[64025:3830396] Leaving autorelease pool, fasten seat belt please!
 2017-09-03 23:32:40.390992+0800 WithARC[64025:3830396] Deallocating OrderEntry object with ID 999...
 2017-09-03 23:32:40.391030+0800 WithARC[64025:3830396] Deallocating Addess object...
 2017-09-03 23:32:40.391040+0800 WithARC[64025:3830396] Deallocating OrderItem object 100 cheeseburgers...
 Program ended with exit code: 0

*/
